OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:true,"double":false,pixelTolerance:0,dblclickTolerance:13,stopSingle:false,stopDouble:false,timerId:null,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(a){this.startTouch();this.down=this.getEventInfo(a);this.last=this.getEventInfo(a);return true},touchmove:function(a){this.last=this.getEventInfo(a);return true},touchend:function(a){if(this.down){a.xy=this.last.xy;a.lastTouches=this.last.touches;this.handleSingle(a);this.down=null}return true},mousedown:function(a){this.down=this.getEventInfo(a);this.last=this.getEventInfo(a);return true},mouseup:function(b){var a=true;if(this.checkModifiers(b)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(b)){a=this.rightclick(b)}return a},rightclick:function(b){if(this.passesTolerance(b)){if(this.rightclickTimerId!=null){this.clearTimer();this.callback("dblrightclick",[b]);return !this.stopDouble}else{var a=this["double"]?OpenLayers.Util.extend({},b):this.callback("rightclick",[b]);var c=OpenLayers.Function.bind(this.delayedRightCall,this,a);this.rightclickTimerId=window.setTimeout(c,this.delay)}}return !this.stopSingle},delayedRightCall:function(a){this.rightclickTimerId=null;if(a){this.callback("rightclick",[a])}},click:function(a){if(!this.last){this.last=this.getEventInfo(a)}this.handleSingle(a);return !this.stopSingle},dblclick:function(a){this.handleDouble(a);return !this.stopDouble},handleDouble:function(a){if(this.passesDblclickTolerance(a)){if(this["double"]){this.callback("dblclick",[a])}this.clearTimer()}},handleSingle:function(b){if(this.passesTolerance(b)){if(this.timerId!=null){if(this.last.touches&&this.last.touches.length===1){if(this["double"]){OpenLayers.Event.preventDefault(b)}this.handleDouble(b)}if(!this.last.touches||this.last.touches.length!==2){this.clearTimer()}}else{this.first=this.getEventInfo(b);var a=this.single?OpenLayers.Util.extend({},b):null;this.queuePotentialClick(a)}}},queuePotentialClick:function(a){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay)},passesTolerance:function(a){var d=true;if(this.pixelTolerance!=null&&this.down&&this.down.xy){d=this.pixelTolerance>=this.down.xy.distanceTo(a.xy);if(d&&this.touch&&this.down.touches.length===this.last.touches.length){for(var b=0,c=this.down.touches.length;b<c;++b){if(this.getTouchDistance(this.down.touches[b],this.last.touches[b])>this.pixelTolerance){d=false;break}}}}return d},getTouchDistance:function(b,a){return Math.sqrt(Math.pow(b.clientX-a.clientX,2)+Math.pow(b.clientY-a.clientY,2))},passesDblclickTolerance:function(a){var b=true;if(this.down&&this.first){b=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance}return b},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null}if(this.rightclickTimerId!=null){window.clearTimeout(this.rightclickTimerId);this.rightclickTimerId=null}},delayedCall:function(a){this.timerId=null;if(a){this.callback("click",[a])}},getEventInfo:function(b){var d;if(b.touches){var a=b.touches.length;d=new Array(a);var e;for(var c=0;c<a;c++){e=b.touches[c];d[c]={clientX:e.olClientX,clientY:e.olClientY}}}return{xy:b.xy,touches:d}},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();this.down=null;this.first=null;this.last=null;a=true}return a},CLASS_NAME:"OpenLayers.Handler.Click"});