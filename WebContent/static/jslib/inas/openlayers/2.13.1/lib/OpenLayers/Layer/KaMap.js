OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(c,b,d,a){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(c){c=this.adjustBounds(c);var d=this.map.getResolution();var e=Math.round((this.map.getScale()*10000))/10000;var b=Math.round(c.left/d);var a=-Math.round(c.top/d);return this.getFullRequestString({t:a,l:b,s:e})},calculateGridLayout:function(a,i,d){var g=d*this.tileSize.w;var c=d*this.tileSize.h;var f=a.left;var h=Math.floor(f/g)-this.buffer;var b=a.top;var e=Math.floor(b/c)+this.buffer;return{tilelon:g,tilelat:c,startcol:h,startrow:e}},getTileBoundsForGridIndex:function(g,c){var b=this.getTileOrigin();var f=this.gridLayout;var e=f.tilelon;var d=f.tilelat;var a=(f.startcol+c)*e;var h=(f.startrow-g)*d;return new OpenLayers.Bounds(a,h,a+e,h+d)},clone:function(a){if(a==null){a=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.getOptions())}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);if(this.tileSize!=null){a.tileSize=this.tileSize.clone()}a.grid=[];return a},getTileBounds:function(c){var e=this.getResolution();var d=e*this.tileSize.w;var b=e*this.tileSize.h;var g=this.getLonLatFromViewPortPx(c);var a=d*Math.floor(g.lon/d);var f=b*Math.floor(g.lat/b);return new OpenLayers.Bounds(a,f,a+d,f+b)},CLASS_NAME:"OpenLayers.Layer.KaMap"});