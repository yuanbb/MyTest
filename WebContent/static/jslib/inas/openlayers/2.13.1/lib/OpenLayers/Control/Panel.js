OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:true,defaultControl:null,saveState:false,allowDepress:false,activeState:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.controls=[];this.activeState={}},destroy:function(){if(this.map){this.map.events.unregister("buttonclick",this,this.onButtonClick)}OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var a,b=this.controls.length-1;b>=0;b--){a=this.controls[b];if(a.events){a.events.un({activate:this.iconOn,deactivate:this.iconOff})}a.panel_div=null}this.activeState=null},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){var c;for(var b=0,a=this.controls.length;b<a;b++){c=this.controls[b];if(c===this.defaultControl||(this.saveState&&this.activeState[c.id])){c.activate()}}if(this.saveState===true){this.defaultControl=null}this.redraw();return true}else{return false}},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){var c;for(var b=0,a=this.controls.length;b<a;b++){c=this.controls[b];this.activeState[c.id]=c.deactivate()}this.redraw();return true}else{return false}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(this.outsideViewport){this.events.attachToElement(this.div);this.events.register("buttonclick",this,this.onButtonClick)}else{this.map.events.register("buttonclick",this,this.onButtonClick)}this.addControlsToMap(this.controls);return this.div},redraw:function(){for(var b=this.div.childNodes.length,c=b-1;c>=0;c--){this.div.removeChild(this.div.childNodes[c])}this.div.innerHTML="";if(this.active){for(var c=0,a=this.controls.length;c<a;c++){this.div.appendChild(this.controls[c].panel_div)}}},activateControl:function(d){if(!this.active){return false}if(d.type==OpenLayers.Control.TYPE_BUTTON){d.trigger();return}if(d.type==OpenLayers.Control.TYPE_TOGGLE){if(d.active){d.deactivate()}else{d.activate()}return}if(this.allowDepress&&d.active){d.deactivate()}else{var e;for(var b=0,a=this.controls.length;b<a;b++){e=this.controls[b];if(e!=d&&(e.type===OpenLayers.Control.TYPE_TOOL||e.type==null)){e.deactivate()}}d.activate()}},addControls:function(b){if(!(OpenLayers.Util.isArray(b))){b=[b]}this.controls=this.controls.concat(b);for(var d=0,a=b.length;d<a;d++){var e=b[d],c=this.createControlMarkup(e);OpenLayers.Element.addClass(c,e.displayClass+"ItemInactive");OpenLayers.Element.addClass(c,"olButton");if(e.title!=""&&!c.title){c.title=e.title}e.panel_div=c}if(this.map){this.addControlsToMap(b);this.redraw()}},createControlMarkup:function(a){return document.createElement("div")},addControlsToMap:function(b){var d;for(var c=0,a=b.length;c<a;c++){d=b[c];if(d.autoActivate===true){d.autoActivate=false;this.map.addControl(d);d.autoActivate=true}else{this.map.addControl(d);d.deactivate()}d.events.on({activate:this.iconOn,deactivate:this.iconOff})}},iconOn:function(){var b=this.panel_div;var a=new RegExp("\\b("+this.displayClass+"Item)Inactive\\b");b.className=b.className.replace(a,"$1Active")},iconOff:function(){var b=this.panel_div;var a=new RegExp("\\b("+this.displayClass+"Item)Active\\b");b.className=b.className.replace(a,"$1Inactive")},onButtonClick:function(a){var b=this.controls,d=a.buttonElement;for(var c=b.length-1;c>=0;--c){if(b[c].panel_div===d){this.activateControl(b[c]);break}}},getControlsBy:function(c,a){var d=(typeof a.test=="function");var b=OpenLayers.Array.filter(this.controls,function(e){return e[c]==a||(d&&a.test(e[c]))});return b},getControlsByName:function(a){return this.getControlsBy("name",a)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},CLASS_NAME:"OpenLayers.Control.Panel"});