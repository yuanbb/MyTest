OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:false,keyMask:null,alwaysZoom:false,zoomOnClick:true,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(u){if(u instanceof OpenLayers.Bounds){var e,n=u.getCenterPixel();if(!this.out){var q=this.map.getLonLatFromPixel({x:u.left,y:u.bottom});var b=this.map.getLonLatFromPixel({x:u.right,y:u.top});e=new OpenLayers.Bounds(q.lon,q.lat,b.lon,b.lat)}else{var s=u.right-u.left;var j=u.bottom-u.top;var c=Math.min((this.map.size.h/j),(this.map.size.w/s));var g=this.map.getExtent();var t=this.map.getLonLatFromPixel(n);var h=t.lon-(g.getWidth()/2)*c;var l=t.lon+(g.getWidth()/2)*c;var o=t.lat-(g.getHeight()/2)*c;var p=t.lat+(g.getHeight()/2)*c;e=new OpenLayers.Bounds(h,o,l,p)}var k=this.map.getZoom(),i=this.map.getSize(),d={x:i.w/2,y:i.h/2},a=this.map.getZoomForExtent(e),f=this.map.getResolution(),r=this.map.getResolutionForZoom(a);if(f==r){this.map.setCenter(this.map.getLonLatFromPixel(n))}else{var m={x:(f*n.x-r*d.x)/(f-r),y:(f*n.y-r*d.y)/(f-r)};this.map.zoomTo(a,m)}if(k==this.map.getZoom()&&this.alwaysZoom==true){this.map.zoomTo(k+(this.out?-1:1))}}else{if(this.zoomOnClick){if(!this.out){this.map.zoomTo(this.map.getZoom()+1,u)}else{this.map.zoomTo(this.map.getZoom()-1,u)}}}},CLASS_NAME:"OpenLayers.Control.ZoomBox"});