OpenLayers.Layer.Zoomify=OpenLayers.Class(OpenLayers.Layer.Grid,{size:null,isBaseLayer:true,standardTileSize:256,tileOriginCorner:"tl",numberOfTiers:0,tileCountUpToTier:null,tierSizeInTiles:null,tierImageSize:null,initialize:function(c,b,d,a){this.initializeZoomify(d);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[c,b,d,{},a])},initializeZoomify:function(d){var e=d.clone();this.size=d.clone();var b=new OpenLayers.Size(Math.ceil(e.w/this.standardTileSize),Math.ceil(e.h/this.standardTileSize));this.tierSizeInTiles=[b];this.tierImageSize=[e];while(e.w>this.standardTileSize||e.h>this.standardTileSize){e=new OpenLayers.Size(Math.floor(e.w/2),Math.floor(e.h/2));b=new OpenLayers.Size(Math.ceil(e.w/this.standardTileSize),Math.ceil(e.h/this.standardTileSize));this.tierSizeInTiles.push(b);this.tierImageSize.push(e)}this.tierSizeInTiles.reverse();this.tierImageSize.reverse();this.numberOfTiers=this.tierSizeInTiles.length;var a=[1];this.tileCountUpToTier=[0];for(var c=1;c<this.numberOfTiers;c++){a.unshift(Math.pow(2,c));this.tileCountUpToTier.push(this.tierSizeInTiles[c-1].w*this.tierSizeInTiles[c-1].h+this.tileCountUpToTier[c-1])}if(!this.serverResolutions){this.serverResolutions=a}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments);this.tileCountUpToTier.length=0;this.tierSizeInTiles.length=0;this.tierImageSize.length=0},clone:function(a){if(a==null){a=new OpenLayers.Layer.Zoomify(this.name,this.url,this.size,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},getURL:function(d){d=this.adjustBounds(d);var c=this.getServerResolution();var a=Math.round((d.left-this.tileOrigin.lon)/(c*this.tileSize.w));var h=Math.round((this.tileOrigin.lat-d.top)/(c*this.tileSize.h));var g=this.getZoomForResolution(c);var f=a+h*this.tierSizeInTiles[g].w+this.tileCountUpToTier[g];var e="TileGroup"+Math.floor((f)/256)+"/"+g+"-"+a+"-"+h+".jpg";var b=this.url;if(OpenLayers.Util.isArray(b)){b=this.selectUrl(e,b)}return b+e},getImageSize:function(){if(arguments.length>0){var e=this.adjustBounds(arguments[0]);var c=this.getServerResolution();var a=Math.round((e.left-this.tileOrigin.lon)/(c*this.tileSize.w));var g=Math.round((this.tileOrigin.lat-e.top)/(c*this.tileSize.h));var f=this.getZoomForResolution(c);var b=this.standardTileSize;var d=this.standardTileSize;if(a==this.tierSizeInTiles[f].w-1){var b=this.tierImageSize[f].w%this.standardTileSize}if(g==this.tierSizeInTiles[f].h-1){var d=this.tierImageSize[f].h%this.standardTileSize}return(new OpenLayers.Size(b,d))}else{return this.tileSize}},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.top)},CLASS_NAME:"OpenLayers.Layer.Zoomify"});