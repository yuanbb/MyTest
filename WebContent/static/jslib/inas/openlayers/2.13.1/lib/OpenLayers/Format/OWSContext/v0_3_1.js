OpenLayers.Format.OWSContext.v0_3_1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{owc:"http://www.opengis.net/ows-context",gml:"http://www.opengis.net/gml",kml:"http://www.opengis.net/kml/2.2",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},VERSION:"0.3.1",schemaLocation:"http://www.opengis.net/ows-context http://www.ogcnetwork.net/schemas/owc/0.3.1/owsContext.xsd",defaultPrefix:"owc",extractAttributes:true,xy:true,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},featureNS:"http://mapserver.gis.umn.edu/mapserver",featureType:"vector",geometryName:"geometry",nestingLayerLookup:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);OpenLayers.Format.GML.v2.prototype.setGeometryTypes.call(this)},setNestingPath:function(b){if(b.layersContext){for(var c=0,a=b.layersContext.length;c<a;c++){var f=b.layersContext[c];var d=[];var e=b.title||"";if(b.metadata&&b.metadata.nestingPath){d=b.metadata.nestingPath.slice()}if(e!=""){d.push(e)}f.metadata.nestingPath=d;if(f.layersContext){this.setNestingPath(f)}}}},decomposeNestingPath:function(c){var b=[];if(OpenLayers.Util.isArray(c)){var d=c.slice();while(d.length>0){b.push(d.slice());d.pop()}b.reverse()}return b},read:function(b){if(typeof b=="string"){b=OpenLayers.Format.XML.prototype.read.apply(this,[b])}if(b&&b.nodeType==9){b=b.documentElement}var a={};this.readNode(b,a);this.setNestingPath({layersContext:a.layersContext});var c=[];this.processLayer(c,a);delete a.layersContext;a.layersContext=c;return a},processLayer:function(b,e){if(e.layersContext){for(var d=0,a=e.layersContext.length;d<a;d++){var c=e.layersContext[d];b.push(c);if(c.layersContext){this.processLayer(b,c)}}}},write:function(d,c){var b="OWSContext";this.nestingLayerLookup={};c=c||{};OpenLayers.Util.applyDefaults(c,d);var a=this.writeNode(b,c);this.nestingLayerLookup=null;this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},readers:{kml:{Document:function(a,b){b.features=new OpenLayers.Format.KML({kmlns:this.namespaces.kml,extractStyles:true}).read(a)}},owc:{OWSContext:function(a,b){this.readChildNodes(a,b)},General:function(a,b){this.readChildNodes(a,b)},ResourceList:function(a,b){this.readChildNodes(a,b)},Layer:function(a,c){var b={metadata:{},visibility:(a.getAttribute("hidden")!="1"),queryable:(a.getAttribute("queryable")=="1"),opacity:((a.getAttribute("opacity")!=null)?parseFloat(a.getAttribute("opacity")):null),name:a.getAttribute("name"),categoryLayer:(a.getAttribute("name")==null),formats:[],styles:[]};if(!c.layersContext){c.layersContext=[]}c.layersContext.push(b);this.readChildNodes(a,b)},InlineGeometry:function(b,d){d.features=[];var c=this.getElementsByTagNameNS(b,this.namespaces.gml,"featureMember");var a;if(c.length>=1){a=c[0]}if(a&&a.firstChild){var e=(a.firstChild.nextSibling)?a.firstChild.nextSibling:a.firstChild;this.setNamespace("feature",e.namespaceURI);this.featureType=e.localName||e.nodeName.split(":").pop();this.readChildNodes(b,d)}},Server:function(a,b){if((!b.service&&!b.version)||(b.service!=OpenLayers.Format.Context.serviceTypes.WMS)){b.service=a.getAttribute("service");b.version=a.getAttribute("version");this.readChildNodes(a,b)}},Name:function(a,b){b.name=this.getChildValue(a);this.readChildNodes(a,b)},Title:function(a,b){b.title=this.getChildValue(a);this.readChildNodes(a,b)},StyleList:function(a,b){this.readChildNodes(a,b.styles)},Style:function(b,c){var a={};c.push(a);this.readChildNodes(b,a)},LegendURL:function(b,c){var a={};c.legend=a;this.readChildNodes(b,a)},OnlineResource:function(a,b){b.url=this.getAttributeNS(a,this.namespaces.xlink,"href");this.readChildNodes(a,b)}},ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows,gml:OpenLayers.Format.GML.v2.prototype.readers.gml,sld:OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{owc:{OWSContext:function(a){var b=this.createElementNSPlus("OWSContext",{attributes:{version:this.VERSION,id:a.id||OpenLayers.Util.createUniqueID("OpenLayers_OWSContext_")}});this.writeNode("General",a,b);this.writeNode("ResourceList",a,b);return b},General:function(a){var b=this.createElementNSPlus("General");this.writeNode("ows:BoundingBox",a,b);this.writeNode("ows:Title",a.title||"OpenLayers OWSContext",b);return b},ResourceList:function(c){var f=this.createElementNSPlus("ResourceList");for(var e=0,b=c.layers.length;e<b;e++){var d=c.layers[e];var a=this.decomposeNestingPath(d.metadata.nestingPath);this.writeNode("_Layer",{layer:d,subPaths:a},f)}return f},Server:function(a){var b=this.createElementNSPlus("Server",{attributes:{version:a.version,service:a.service}});this.writeNode("OnlineResource",a,b);return b},OnlineResource:function(a){var b=this.createElementNSPlus("OnlineResource",{attributes:{"xlink:href":a.url}});return b},InlineGeometry:function(c){var d=this.createElementNSPlus("InlineGeometry"),e=c.getDataExtent();if(e!==null){this.writeNode("gml:boundedBy",e,d)}for(var b=0,a=c.features.length;b<a;b++){this.writeNode("gml:featureMember",c.features[b],d)}return d},StyleList:function(d){var c=this.createElementNSPlus("StyleList");for(var b=0,a=d.length;b<a;b++){this.writeNode("Style",d[b],c)}return c},Style:function(a){var b=this.createElementNSPlus("Style");this.writeNode("Name",a,b);this.writeNode("Title",a,b);if(a.legend){this.writeNode("LegendURL",a,b)}return b},Name:function(b){var a=this.createElementNSPlus("Name",{value:b.name});return a},Title:function(b){var a=this.createElementNSPlus("Title",{value:b.title});return a},LegendURL:function(a){var b=this.createElementNSPlus("LegendURL");this.writeNode("OnlineResource",a.legend,b);return b},_WMS:function(a){var b=this.createElementNSPlus("Layer",{attributes:{name:a.params.LAYERS,queryable:a.queryable?"1":"0",hidden:a.visibility?"0":"1",opacity:a.hasOwnProperty("opacity")?a.opacity:null}});this.writeNode("ows:Title",a.name,b);this.writeNode("ows:OutputFormat",a.params.FORMAT,b);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WMS,version:a.params.VERSION,url:a.url},b);if(a.metadata.styles&&a.metadata.styles.length>0){this.writeNode("StyleList",a.metadata.styles,b)}return b},_Layer:function(b){var c,g,d,f;c=b.layer;g=b.subPaths;d=null;f=null;if(g.length>0){var e=g[0].join("/");var a=e.lastIndexOf("/");d=this.nestingLayerLookup[e];f=(a>0)?e.substring(a+1,e.length):e;if(!d){d=this.createElementNSPlus("Layer");this.writeNode("ows:Title",f,d);this.nestingLayerLookup[e]=d}b.subPaths.shift();this.writeNode("_Layer",b,d);return d}else{if(c instanceof OpenLayers.Layer.WMS){d=this.writeNode("_WMS",c)}else{if(c instanceof OpenLayers.Layer.Vector){if(c.protocol instanceof OpenLayers.Protocol.WFS.v1){d=this.writeNode("_WFS",c)}else{if(c.protocol instanceof OpenLayers.Protocol.HTTP){if(c.protocol.format instanceof OpenLayers.Format.GML){c.protocol.format.version="2.1.2";d=this.writeNode("_GML",c)}else{if(c.protocol.format instanceof OpenLayers.Format.KML){c.protocol.format.version="2.2";d=this.writeNode("_KML",c)}}}else{this.setNamespace("feature",this.featureNS);d=this.writeNode("_InlineGeometry",c)}}}}if(c.options.maxScale){this.writeNode("sld:MinScaleDenominator",c.options.maxScale,d)}if(c.options.minScale){this.writeNode("sld:MaxScaleDenominator",c.options.minScale,d)}this.nestingLayerLookup[c.name]=d;return d}},_WFS:function(a){var b=this.createElementNSPlus("Layer",{attributes:{name:a.protocol.featurePrefix+":"+a.protocol.featureType,hidden:a.visibility?"0":"1"}});this.writeNode("ows:Title",a.name,b);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WFS,version:a.protocol.version,url:a.protocol.url},b);return b},_InlineGeometry:function(a){var b=this.createElementNSPlus("Layer",{attributes:{name:this.featureType,hidden:a.visibility?"0":"1"}});this.writeNode("ows:Title",a.name,b);this.writeNode("InlineGeometry",a,b);return b},_GML:function(a){var b=this.createElementNSPlus("Layer");this.writeNode("ows:Title",a.name,b);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.GML,url:a.protocol.url,version:a.protocol.format.version},b);return b},_KML:function(a){var b=this.createElementNSPlus("Layer");this.writeNode("ows:Title",a.name,b);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.KML,version:a.protocol.format.version,url:a.protocol.url},b);return b}},gml:OpenLayers.Util.applyDefaults({boundedBy:function(b){var a=this.createElementNSPlus("gml:boundedBy");this.writeNode("gml:Box",b,a);return a}},OpenLayers.Format.GML.v2.prototype.writers.gml),ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.writers.ows,sld:OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},CLASS_NAME:"OpenLayers.Format.OWSContext.v0_3_1"});