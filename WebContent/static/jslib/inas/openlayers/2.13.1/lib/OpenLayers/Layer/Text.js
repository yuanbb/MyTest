OpenLayers.Layer.Text=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(b,a){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments);this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadText:function(){if(!this.loaded){if(this.location!=null){var a=function(b){this.events.triggerEvent("loadend")};this.events.triggerEvent("loadstart");OpenLayers.Request.GET({url:this.location,success:this.parseData,failure:a,scope:this});this.loaded=true}}},moveTo:function(c,a,b){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);if(this.visibility&&!this.loaded){this.loadText()}},parseData:function(k){var m=k.responseText;var o={};OpenLayers.Util.extend(o,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){o.externalProjection=this.projection;o.internalProjection=this.map.getProjectionObject()}var b=new OpenLayers.Format.Text(o);var c=b.read(m);for(var g=0,h=c.length;g<h;g++){var f={};var n=c[g];var l;var j,d;l=new OpenLayers.LonLat(n.geometry.x,n.geometry.y);if(n.style.graphicWidth&&n.style.graphicHeight){j=new OpenLayers.Size(n.style.graphicWidth,n.style.graphicHeight)}if(n.style.graphicXOffset!==undefined&&n.style.graphicYOffset!==undefined){d=new OpenLayers.Pixel(n.style.graphicXOffset,n.style.graphicYOffset)}if(n.style.externalGraphic!=null){f.icon=new OpenLayers.Icon(n.style.externalGraphic,j,d)}else{f.icon=OpenLayers.Marker.defaultIcon();if(j!=null){f.icon.setSize(j)}}if((n.attributes.title!=null)&&(n.attributes.description!=null)){f.popupContentHTML="<h2>"+n.attributes.title+"</h2><p>"+n.attributes.description+"</p>"}f.overflow=n.attributes.overflow||"auto";var a=new OpenLayers.Feature(this,l,f);this.features.push(a);var e=a.createMarker();if((n.attributes.title!=null)&&(n.attributes.description!=null)){e.events.register("click",a,this.markerClick)}this.addMarker(e)}this.events.triggerEvent("loadend")},markerClick:function(b){var d=(this==this.layer.selectedFeature);this.layer.selectedFeature=(!d)?this:null;for(var c=0,a=this.layer.map.popups.length;c<a;c++){this.layer.map.removePopup(this.layer.map.popups[c])}if(!d){this.layer.map.addPopup(this.createPopup())}OpenLayers.Event.stop(b)},clearFeatures:function(){if(this.features!=null){while(this.features.length>0){var a=this.features[0];OpenLayers.Util.removeItem(this.features,a);a.destroy()}}},CLASS_NAME:"OpenLayers.Layer.Text"});