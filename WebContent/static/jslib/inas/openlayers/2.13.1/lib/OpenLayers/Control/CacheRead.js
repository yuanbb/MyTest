OpenLayers.Control.CacheRead=OpenLayers.Class(OpenLayers.Control,{fetchEvent:"tileloadstart",layers:null,autoActivate:true,setMap:function(c){OpenLayers.Control.prototype.setMap.apply(this,arguments);var a,b=this.layers||c.layers;for(a=b.length-1;a>=0;--a){this.addLayer({layer:b[a]})}if(!this.layers){c.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})}},addLayer:function(a){a.layer.events.register(this.fetchEvent,this,this.fetch)},removeLayer:function(a){a.layer.events.unregister(this.fetchEvent,this,this.fetch)},fetch:function(b){if(this.active&&window.localStorage&&b.tile instanceof OpenLayers.Tile.Image){var d=b.tile,c=d.url;if(!d.layer.crossOriginKeyword&&OpenLayers.ProxyHost&&c.indexOf(OpenLayers.ProxyHost)===0){c=OpenLayers.Control.CacheWrite.urlMap[c]}var a=window.localStorage.getItem("olCache_"+c);if(a){d.url=a;if(b.type==="tileerror"){d.setImgSrc(a)}}}},destroy:function(){if(this.layers||this.map){var a,b=this.layers||this.map.layers;for(a=b.length-1;a>=0;--a){this.removeLayer({layer:b[a]})}}if(this.map){this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})}OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheRead"});