OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:["mousedown","mouseup","click","dblclick","touchstart","touchmove","touchend","keydown"],startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(b){this.target=b;for(var a=this.events.length-1;a>=0;--a){this.target.register(this.events[a],this,this.buttonClick,{extension:true})}},destroy:function(){for(var a=this.events.length-1;a>=0;--a){this.target.unregister(this.events[a],this,this.buttonClick)}delete this.target},getPressedButton:function(b){var c=3,a;do{if(OpenLayers.Element.hasClass(b,"olButton")){a=b;break}b=b.parentNode}while(--c>0&&b);return a},ignore:function(a){var b=3,c=false;do{if(a.nodeName.toLowerCase()==="a"){c=true;break}a=a.parentNode}while(--b>0&&a);return c},buttonClick:function(b){var a=true,e=OpenLayers.Event.element(b);if(e&&(OpenLayers.Event.isLeftClick(b)||!~b.type.indexOf("mouse"))){var d=this.getPressedButton(e);if(d){if(b.type==="keydown"){switch(b.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:d});OpenLayers.Event.stop(b);a=false;break}}else{if(this.startEvt){if(this.completeRegEx.test(b.type)){var h=OpenLayers.Util.pagePosition(d);var c=OpenLayers.Util.getViewportElement();var f=window.pageYOffset||c.scrollTop;var g=window.pageXOffset||c.scrollLeft;h[0]=h[0]-g;h[1]=h[1]-f;this.target.triggerEvent("buttonclick",{buttonElement:d,buttonXY:{x:this.startEvt.clientX-h[0],y:this.startEvt.clientY-h[1]}})}if(this.cancelRegEx.test(b.type)){delete this.startEvt}OpenLayers.Event.stop(b);a=false}}if(this.startRegEx.test(b.type)){this.startEvt=b;OpenLayers.Event.stop(b);a=false}}else{a=!this.ignore(OpenLayers.Event.element(b));delete this.startEvt}}return a}});