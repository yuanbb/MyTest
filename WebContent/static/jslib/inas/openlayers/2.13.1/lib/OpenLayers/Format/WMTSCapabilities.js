OpenLayers.Format.WMTSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":true},createLayer:function(c,D){var G;if(!("layer" in D)){throw new Error("Missing property 'layer' in configuration.")}var x=c.contents;var f=x.layers;var q;for(var v=0,l=x.layers.length;v<l;++v){if(x.layers[v].identifier===D.layer){q=x.layers[v];break}}if(!q){throw new Error("Layer not found")}var w=D.format;if(!w&&q.formats&&q.formats.length){w=q.formats[0]}var g;if(D.matrixSet){g=x.tileMatrixSets[D.matrixSet]}else{if(q.tileMatrixSetLinks.length>=1){g=x.tileMatrixSets[q.tileMatrixSetLinks[0].tileMatrixSet]}}if(!g){throw new Error("matrixSet not found")}var y;for(var v=0,l=q.styles.length;v<l;++v){y=q.styles[v];if(y.isDefault){break}}var B=D.requestEncoding;if(!B){B="KVP";if(c.operationsMetadata.GetTile.dcp.http){var u=c.operationsMetadata.GetTile.dcp.http;if(u.get[0].constraints){var s=u.get[0].constraints;var p=s.GetEncoding.allowedValues;if(!p.KVP&&(p.REST||p.RESTful)){B="REST"}}}}var e=[];var A=D.params||{};delete D.params;for(var n=0,o=q.dimensions.length;n<o;n++){var z=q.dimensions[n];e.push(z.identifier);if(!A.hasOwnProperty(z.identifier)){A[z.identifier]=z["default"]}}var E=D.projection||g.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3");var r=D.units||(E==="EPSG:4326"?"degrees":"m");var h=[];for(var C in g.matrixIds){if(g.matrixIds.hasOwnProperty(C)){h.push(g.matrixIds[C].scaleDenominator*0.00028/OpenLayers.METERS_PER_INCH/OpenLayers.INCHES_PER_UNIT[r])}}var d;if(B==="REST"&&q.resourceUrls){d=[];var F=q.resourceUrls,k;for(var m=0,b=q.resourceUrls.length;m<b;++m){k=q.resourceUrls[m];if(k.format===w&&k.resourceType==="tile"){d.push(k.template)}}}else{var j=c.operationsMetadata.GetTile.dcp.http.get;d=[];var a;for(var v=0,l=j.length;v<l;v++){a=j[v].constraints;if(!a||(a&&a.GetEncoding.allowedValues[B])){d.push(j[v].url)}}}return new OpenLayers.Layer.WMTS(OpenLayers.Util.applyDefaults(D,{url:d,requestEncoding:B,name:q.title,style:y.identifier,format:w,matrixIds:g.matrixIds,matrixSet:g.identifier,projection:E,units:r,resolutions:D.isBaseLayer===false?undefined:h,serverResolutions:h,tileFullExtent:g.bounds,dimensions:e,params:A}))},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities"});