OpenLayers.Format.Atom=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{atom:"http://www.w3.org/2005/Atom",georss:"http://www.georss.org/georss"},feedTitle:"untitled",defaultEntryTitle:"untitled",gmlParser:null,xy:false,read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}return this.parseFeatures(a)},write:function(c){var d;if(OpenLayers.Util.isArray(c)){d=this.createElementNSPlus("atom:feed");d.appendChild(this.createElementNSPlus("atom:title",{value:this.feedTitle}));for(var a=0,b=c.length;a<b;a++){d.appendChild(this.buildEntryNode(c[a]))}}else{d=this.buildEntryNode(c)}return OpenLayers.Format.XML.prototype.write.apply(this,[d])},buildContentNode:function(b){var a=this.createElementNSPlus("atom:content",{attributes:{type:b.type||null}});if(b.src){a.setAttribute("src",b.src)}else{if(b.type=="text"||b.type==null){a.appendChild(this.createTextNode(b.value))}else{if(b.type=="html"){if(typeof b.value!="string"){throw"HTML content must be in form of an escaped string"}a.appendChild(this.createTextNode(b.value))}else{if(b.type=="xhtml"){a.appendChild(b.value)}else{if(b.type=="xhtml"||b.type.match(/(\+|\/)xml$/)){a.appendChild(b.value)}else{a.appendChild(this.createTextNode(b.value))}}}}}return a},buildEntryNode:function(n){var c=n.attributes;var j=c.atom||{};var k=this.createElementNSPlus("atom:entry");if(j.authors){var h=OpenLayers.Util.isArray(j.authors)?j.authors:[j.authors];for(var d=0,m=h.length;d<m;d++){k.appendChild(this.buildPersonConstructNode("author",h[d]))}}if(j.categories){var e=OpenLayers.Util.isArray(j.categories)?j.categories:[j.categories];var a;for(var d=0,m=e.length;d<m;d++){a=e[d];k.appendChild(this.createElementNSPlus("atom:category",{attributes:{term:a.term,scheme:a.scheme||null,label:a.label||null}}))}}if(j.content){k.appendChild(this.buildContentNode(j.content))}if(j.contributors){var f=OpenLayers.Util.isArray(j.contributors)?j.contributors:[j.contributors];for(var d=0,m=f.length;d<m;d++){k.appendChild(this.buildPersonConstructNode("contributor",f[d]))}}if(n.fid){k.appendChild(this.createElementNSPlus("atom:id",{value:n.fid}))}if(j.links){var l=OpenLayers.Util.isArray(j.links)?j.links:[j.links];var g;for(var d=0,m=l.length;d<m;d++){g=l[d];k.appendChild(this.createElementNSPlus("atom:link",{attributes:{href:g.href,rel:g.rel||null,type:g.type||null,hreflang:g.hreflang||null,title:g.title||null,length:g.length||null}}))}}if(j.published){k.appendChild(this.createElementNSPlus("atom:published",{value:j.published}))}if(j.rights){k.appendChild(this.createElementNSPlus("atom:rights",{value:j.rights}))}if(j.summary||c.description){k.appendChild(this.createElementNSPlus("atom:summary",{value:j.summary||c.description}))}k.appendChild(this.createElementNSPlus("atom:title",{value:j.title||c.title||this.defaultEntryTitle}));if(j.updated){k.appendChild(this.createElementNSPlus("atom:updated",{value:j.updated}))}if(n.geometry){var b=this.createElementNSPlus("georss:where");b.appendChild(this.buildGeometryNode(n.geometry));k.appendChild(b)}return k},initGmlParser:function(){this.gmlParser=new OpenLayers.Format.GML.v3({xy:this.xy,featureNS:"http://example.com#feature",internalProjection:this.internalProjection,externalProjection:this.externalProjection})},buildGeometryNode:function(b){if(!this.gmlParser){this.initGmlParser()}var a=this.gmlParser.writeNode("feature:_geometry",b);return a.firstChild},buildPersonConstructNode:function(b,f){var d=["uri","email"];var a=this.createElementNSPlus("atom:"+b);a.appendChild(this.createElementNSPlus("atom:name",{value:f.name}));for(var c=0,e=d.length;c<e;c++){if(f[d[c]]){a.appendChild(this.createElementNSPlus("atom:"+d[c],{value:f[d[c]]}))}}return a},getFirstChildValue:function(d,b,c,f){var e;var a=this.getElementsByTagNameNS(d,b,c);if(a&&a.length>0){e=this.getChildValue(a[0],f)}else{e=f}return e},parseFeature:function(d){var m={};var n=null;var a=null;var k=null;var b=this.namespaces.atom;this.parsePersonConstructs(d,"author",m);a=this.getElementsByTagNameNS(d,b,"category");if(a.length>0){m.categories=[]}for(var g=0,o=a.length;g<o;g++){n={};n.term=a[g].getAttribute("term");k=a[g].getAttribute("scheme");if(k){n.scheme=k}k=a[g].getAttribute("label");if(k){n.label=k}m.categories.push(n)}a=this.getElementsByTagNameNS(d,b,"content");if(a.length>0){n={};k=a[0].getAttribute("type");if(k){n.type=k}k=a[0].getAttribute("src");if(k){n.src=k}else{if(n.type=="text"||n.type=="html"||n.type==null){n.value=this.getFirstChildValue(d,b,"content",null)}else{if(n.type=="xhtml"||n.type.match(/(\+|\/)xml$/)){n.value=this.getChildEl(a[0])}else{n.value=this.getFirstChildValue(d,b,"content",null)}}m.content=n}}this.parsePersonConstructs(d,"contributor",m);m.id=this.getFirstChildValue(d,b,"id",null);a=this.getElementsByTagNameNS(d,b,"link");if(a.length>0){m.links=new Array(a.length)}var c=["rel","type","hreflang","title","length"];for(var g=0,o=a.length;g<o;g++){n={};n.href=a[g].getAttribute("href");for(var e=0,h=c.length;e<h;e++){k=a[g].getAttribute(c[e]);if(k){n[c[e]]=k}}m.links[g]=n}n=this.getFirstChildValue(d,b,"published",null);if(n){m.published=n}n=this.getFirstChildValue(d,b,"rights",null);if(n){m.rights=n}n=this.getFirstChildValue(d,b,"summary",null);if(n){m.summary=n}m.title=this.getFirstChildValue(d,b,"title",null);m.updated=this.getFirstChildValue(d,b,"updated",null);var f={title:m.title,description:m.summary,atom:m};var l=this.parseLocations(d)[0];var p=new OpenLayers.Feature.Vector(l,f);p.fid=m.id;return p},parseFeatures:function(e){var d=[];var a=this.getElementsByTagNameNS(e,this.namespaces.atom,"entry");if(a.length==0){a=[e]}for(var b=0,c=a.length;b<c;b++){d.push(this.parseFeature(a[b]))}return d},parseLocations:function(c){var a=this.namespaces.georss;var k={components:[]};var f=this.getElementsByTagNameNS(c,a,"where");if(f&&f.length>0){if(!this.gmlParser){this.initGmlParser()}for(var e=0,q=f.length;e<q;e++){this.gmlParser.readChildNodes(f[e],k)}}var h=k.components;var n=this.getElementsByTagNameNS(c,a,"point");if(n&&n.length>0){for(var e=0,q=n.length;e<q;e++){var s=OpenLayers.String.trim(n[e].firstChild.nodeValue).split(/\s+/);if(s.length!=2){s=OpenLayers.String.trim(n[e].firstChild.nodeValue).split(/\s*,\s*/)}h.push(new OpenLayers.Geometry.Point(s[1],s[0]))}}var r=this.getElementsByTagNameNS(c,a,"line");if(r&&r.length>0){var m;var b;var o;for(var e=0,q=r.length;e<q;e++){m=OpenLayers.String.trim(r[e].firstChild.nodeValue).split(/\s+/);o=[];for(var d=0,g=m.length;d<g;d+=2){b=new OpenLayers.Geometry.Point(m[d+1],m[d]);o.push(b)}h.push(new OpenLayers.Geometry.LineString(o))}}var l=this.getElementsByTagNameNS(c,a,"polygon");if(l&&l.length>0){var m;var b;var o;for(var e=0,q=l.length;e<q;e++){m=OpenLayers.String.trim(l[e].firstChild.nodeValue).split(/\s+/);o=[];for(var d=0,g=m.length;d<g;d+=2){b=new OpenLayers.Geometry.Point(m[d+1],m[d]);o.push(b)}h.push(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(o)]))}}if(this.internalProjection&&this.externalProjection){for(var e=0,q=h.length;e<q;e++){if(h[e]){h[e].transform(this.externalProjection,this.internalProjection)}}}return h},parsePersonConstructs:function(d,a,g){var m=[];var c=this.namespaces.atom;var b=this.getElementsByTagNameNS(d,c,a);var e=["uri","email"];for(var h=0,o=b.length;h<o;h++){var n={};n.name=this.getFirstChildValue(b[h],c,"name",null);for(var f=0,k=e.length;f<k;f++){var l=this.getFirstChildValue(b[h],c,e[f],null);if(l){n[e[f]]=l}}m.push(n)}if(m.length>0){g[a+"s"]=m}},CLASS_NAME:"OpenLayers.Format.Atom"});