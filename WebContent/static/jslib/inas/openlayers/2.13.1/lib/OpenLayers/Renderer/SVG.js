OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15000,translationParameters:null,symbolMetrics:null,initialize:function(a){if(!this.supported()){return}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);this.translationParameters={x:0,y:0};this.symbolMetrics={}},supported:function(){var a="http://www.w3.org/TR/SVG11/feature#";return(document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(a+"SVG","1.1")||document.implementation.hasFeature(a+"BasicStructure","1.1")))},inValidRange:function(a,e,b){var d=a+(b?0:this.translationParameters.x);var c=e+(b?0:this.translationParameters.y);return(d>=-this.MAX_PIXEL&&d<=this.MAX_PIXEL&&c>=-this.MAX_PIXEL&&c<=this.MAX_PIXEL)},setExtent:function(c,e){var b=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var a=this.getResolution(),g=-c.left/a,f=c.top/a;if(e){this.left=g;this.top=f;var d="0 0 "+this.size.w+" "+this.size.h;this.rendererRoot.setAttributeNS(null,"viewBox",d);this.translate(this.xOffset,0);return true}else{var h=this.translate(g-this.left+this.xOffset,f-this.top);if(!h){this.setExtent(c,true)}return b&&h}},translate:function(a,c){if(!this.inValidRange(a,c,true)){return false}else{var b="";if(a||c){b="translate("+a+","+c+")"}this.root.setAttributeNS(null,"transform",b);this.translationParameters={x:a,y:c};return true}},setSize:function(a){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(c,b){var a=null;switch(c.CLASS_NAME){case"OpenLayers.Geometry.Point":if(b.externalGraphic){a="image"}else{if(this.isComplexSymbol(b.graphicName)){a="svg"}else{a="circle"}}break;case"OpenLayers.Geometry.Rectangle":a="rect";break;case"OpenLayers.Geometry.LineString":a="polyline";break;case"OpenLayers.Geometry.LinearRing":a="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":a="path";break;default:break}return a},setStyle:function(p,t,b){t=t||p._style;b=b||p._options;var v=t.title||t.graphicTitle;if(v){p.setAttributeNS(null,"title",v);var o=p.getElementsByTagName("title");if(o.length>0){o[0].firstChild.textContent=v}else{var f=this.nodeFactory(null,"title");f.textContent=v;p.appendChild(f)}}var k=parseFloat(p.getAttributeNS(null,"r"));var j=1;var d;if(p._geometryClass=="OpenLayers.Geometry.Point"&&k){p.style.visibility="";if(t.graphic===false){p.style.visibility="hidden"}else{if(t.externalGraphic){d=this.getPosition(p);if(t.graphicWidth&&t.graphicHeight){p.setAttributeNS(null,"preserveAspectRatio","none")}var n=t.graphicWidth||t.graphicHeight;var m=t.graphicHeight||t.graphicWidth;n=n?n:t.pointRadius*2;m=m?m:t.pointRadius*2;var u=(t.graphicXOffset!=undefined)?t.graphicXOffset:-(0.5*n);var g=(t.graphicYOffset!=undefined)?t.graphicYOffset:-(0.5*m);var a=t.graphicOpacity||t.fillOpacity;p.setAttributeNS(null,"x",(d.x+u).toFixed());p.setAttributeNS(null,"y",(d.y+g).toFixed());p.setAttributeNS(null,"width",n);p.setAttributeNS(null,"height",m);p.setAttributeNS(this.xlinkns,"xlink:href",t.externalGraphic);p.setAttributeNS(null,"style","opacity: "+a);p.onclick=OpenLayers.Event.preventDefault}else{if(this.isComplexSymbol(t.graphicName)){var c=t.pointRadius*3;var l=c*2;var e=this.importSymbol(t.graphicName);d=this.getPosition(p);j=this.symbolMetrics[e.id][0]*3/l;var h=p.parentNode;var i=p.nextSibling;if(h){h.removeChild(p)}p.firstChild&&p.removeChild(p.firstChild);p.appendChild(e.firstChild.cloneNode(true));p.setAttributeNS(null,"viewBox",e.getAttributeNS(null,"viewBox"));p.setAttributeNS(null,"width",l);p.setAttributeNS(null,"height",l);p.setAttributeNS(null,"x",d.x-c);p.setAttributeNS(null,"y",d.y-c);if(i){h.insertBefore(p,i)}else{if(h){h.appendChild(p)}}}else{p.setAttributeNS(null,"r",t.pointRadius)}}}var s=t.rotation;if((s!==undefined||p._rotation!==undefined)&&d){p._rotation=s;s|=0;if(p.nodeName!=="svg"){p.setAttributeNS(null,"transform","rotate("+s+" "+d.x+" "+d.y+")")}else{var q=this.symbolMetrics[e.id];p.firstChild.setAttributeNS(null,"transform","rotate("+s+" "+q[1]+" "+q[2]+")")}}}if(b.isFilled){p.setAttributeNS(null,"fill",t.fillColor);p.setAttributeNS(null,"fill-opacity",t.fillOpacity)}else{p.setAttributeNS(null,"fill","none")}if(b.isStroked){p.setAttributeNS(null,"stroke",t.strokeColor);p.setAttributeNS(null,"stroke-opacity",t.strokeOpacity);p.setAttributeNS(null,"stroke-width",t.strokeWidth*j);p.setAttributeNS(null,"stroke-linecap",t.strokeLinecap||"round");p.setAttributeNS(null,"stroke-linejoin","round");t.strokeDashstyle&&p.setAttributeNS(null,"stroke-dasharray",this.dashStyle(t,j))}else{p.setAttributeNS(null,"stroke","none")}if(t.pointerEvents){p.setAttributeNS(null,"pointer-events",t.pointerEvents)}if(t.cursor!=null){p.setAttributeNS(null,"cursor",t.cursor)}return p},dashStyle:function(c,b){var a=c.strokeWidth*b;var d=c.strokeDashstyle;switch(d){case"solid":return"none";case"dot":return[1,4*a].join();case"dash":return[4*a,4*a].join();case"dashdot":return[4*a,4*a,1,4*a].join();case"longdash":return[8*a,4*a].join();case"longdashdot":return[8*a,4*a,1,4*a].join();default:return OpenLayers.String.trim(d).replace(/\s+/g,",")}},createNode:function(a,c){var b=document.createElementNS(this.xmlns,a);if(c){b.setAttributeNS(null,"id",c)}return b},nodeTypeCompare:function(b,a){return(a==b.nodeName)},createRenderRoot:function(){var a=this.nodeFactory(this.container.id+"_svgRoot","svg");a.style.display="block";return a},createRoot:function(a){return this.nodeFactory(this.container.id+a,"g")},createDefs:function(){var a=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(a);return a},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(d,e,b){var c=this.getResolution();var a=((e.x-this.featureDx)/c+this.left);var f=(this.top-e.y/c);if(this.inValidRange(a,f)){d.setAttributeNS(null,"cx",a);d.setAttributeNS(null,"cy",f);d.setAttributeNS(null,"r",b);return d}else{return false}},drawLineString:function(b,c){var a=this.getComponentsString(c.components);if(a.path){b.setAttributeNS(null,"points",a.path);return(a.complete?b:null)}else{return false}},drawLinearRing:function(b,c){var a=this.getComponentsString(c.components);if(a.path){b.setAttributeNS(null,"points",a.path);return(a.complete?b:null)}else{return false}},drawPolygon:function(b,h){var g="";var i=true;var a=true;var c,k;for(var e=0,f=h.components.length;e<f;e++){g+=" M";c=this.getComponentsString(h.components[e].components," ");k=c.path;if(k){g+=" "+k;a=c.complete&&a}else{i=false}}g+=" z";if(i){b.setAttributeNS(null,"d",g);b.setAttributeNS(null,"fill-rule","evenodd");return a?b:null}else{return false}},drawRectangle:function(c,d){var b=this.getResolution();var a=((d.x-this.featureDx)/b+this.left);var e=(this.top-d.y/b);if(this.inValidRange(a,e)){c.setAttributeNS(null,"x",a);c.setAttributeNS(null,"y",e);c.setAttributeNS(null,"width",d.width/b);c.setAttributeNS(null,"height",d.height/b);return c}else{return false}},drawText:function(f,b,p){var a=(!!b.labelOutlineWidth);if(a){var l=OpenLayers.Util.extend({},b);l.fontColor=l.labelOutlineColor;l.fontStrokeColor=l.labelOutlineColor;l.fontStrokeWidth=b.labelOutlineWidth;if(b.labelOutlineOpacity){l.fontOpacity=b.labelOutlineOpacity}delete l.labelOutlineWidth;this.drawText(f,l,p)}var c=this.getResolution();var o=((p.x-this.featureDx)/c+this.left);var k=(p.y/c-this.top);var q=(a)?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX;var n=this.nodeFactory(f+q,"text");n.setAttributeNS(null,"x",o);n.setAttributeNS(null,"y",-k);if(b.fontColor){n.setAttributeNS(null,"fill",b.fontColor)}if(b.fontStrokeColor){n.setAttributeNS(null,"stroke",b.fontStrokeColor)}if(b.fontStrokeWidth){n.setAttributeNS(null,"stroke-width",b.fontStrokeWidth)}if(b.fontOpacity){n.setAttributeNS(null,"opacity",b.fontOpacity)}if(b.fontFamily){n.setAttributeNS(null,"font-family",b.fontFamily)}if(b.fontSize){n.setAttributeNS(null,"font-size",b.fontSize)}if(b.fontWeight){n.setAttributeNS(null,"font-weight",b.fontWeight)}if(b.fontStyle){n.setAttributeNS(null,"font-style",b.fontStyle)}if(b.labelSelect===true){n.setAttributeNS(null,"pointer-events","visible");n._featureId=f}else{n.setAttributeNS(null,"pointer-events","none")}var h=b.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;n.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[h[0]]||"middle");if(OpenLayers.IS_GECKO===true){n.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[h[1]]||"central")}var d=b.label.split("\n");var g=d.length;while(n.childNodes.length>g){n.removeChild(n.lastChild)}for(var e=0;e<g;e++){var j=this.nodeFactory(f+q+"_tspan_"+e,"tspan");if(b.labelSelect===true){j._featureId=f;j._geometry=p;j._geometryClass=p.CLASS_NAME}if(OpenLayers.IS_GECKO===false){j.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[h[1]]||"-35%")}j.setAttribute("x",o);if(e==0){var m=OpenLayers.Renderer.SVG.LABEL_VFACTOR[h[1]];if(m==null){m=-0.5}j.setAttribute("dy",(m*(g-1))+"em")}else{j.setAttribute("dy","1em")}j.textContent=(d[e]==="")?" ":d[e];if(!j.parentNode){n.appendChild(j)}}if(!n.parentNode){this.textRoot.appendChild(n)}},getComponentsString:function(d,c){var f=[];var a=true;var e=d.length;var j=[];var g,h;for(var b=0;b<e;b++){h=d[b];f.push(h);g=this.getShortString(h);if(g){j.push(g)}else{if(b>0){if(this.getShortString(d[b-1])){j.push(this.clipLine(d[b],d[b-1]))}}if(b<e-1){if(this.getShortString(d[b+1])){j.push(this.clipLine(d[b],d[b+1]))}}a=false}}return{path:j.join(c||","),complete:a}},clipLine:function(e,h){if(h.equals(e)){return""}var f=this.getResolution();var b=this.MAX_PIXEL-this.translationParameters.x;var a=this.MAX_PIXEL-this.translationParameters.y;var d=(h.x-this.featureDx)/f+this.left;var j=this.top-h.y/f;var c=(e.x-this.featureDx)/f+this.left;var i=this.top-e.y/f;var g;if(c<-b||c>b){g=(i-j)/(c-d);c=c<0?-b:b;i=j+(c-d)*g}if(i<-a||i>a){g=(c-d)/(i-j);i=i<0?-a:a;c=d+(i-j)*g}return c+","+i},getShortString:function(b){var c=this.getResolution();var a=((b.x-this.featureDx)/c+this.left);var d=(this.top-b.y/c);if(this.inValidRange(a,d)){return a+","+d}else{return false}},getPosition:function(a){return({x:parseFloat(a.getAttributeNS(null,"cx")),y:parseFloat(a.getAttributeNS(null,"cy"))})},importSymbol:function(f){if(!this.defs){this.defs=this.createDefs()}var b=this.container.id+"-"+f;var c=document.getElementById(b);if(c!=null){return c}var e=OpenLayers.Renderer.symbol[f];if(!e){throw new Error(f+" is not a valid symbol name")}var h=this.nodeFactory(b,"symbol");var d=this.nodeFactory(null,"polygon");h.appendChild(d);var n=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var l=[];var k,j;for(var g=0;g<e.length;g=g+2){k=e[g];j=e[g+1];n.left=Math.min(n.left,k);n.bottom=Math.min(n.bottom,j);n.right=Math.max(n.right,k);n.top=Math.max(n.top,j);l.push(k,",",j)}d.setAttributeNS(null,"points",l.join(" "));var a=n.getWidth();var m=n.getHeight();var o=[n.left-a,n.bottom-m,a*3,m*3];h.setAttributeNS(null,"viewBox",o.join(" "));this.symbolMetrics[b]=[Math.max(a,m),n.getCenterLonLat().lon,n.getCenterLonLat().lat];this.defs.appendChild(h);return h},getFeatureIdFromEvent:function(a){var c=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!c){var b=a.target;c=b.parentNode&&b!=this.rendererRoot?b.parentNode._featureId:undefined}return c},CLASS_NAME:"OpenLayers.Renderer.SVG"});OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1};OpenLayers.Renderer.SVG.preventDefault=function(a){OpenLayers.Event.preventDefault(a)};