OpenLayers.Tile.UTFGrid=OpenLayers.Class(OpenLayers.Tile,{url:null,utfgridResolution:2,json:null,format:null,destroy:function(){this.clear();OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var b=OpenLayers.Tile.prototype.draw.apply(this,arguments);if(b){if(this.isLoading){this.abortLoading();this.events.triggerEvent("reload")}else{this.isLoading=true;this.events.triggerEvent("loadstart")}this.url=this.layer.getURL(this.bounds);if(this.layer.useJSONP){var a=new OpenLayers.Protocol.Script({url:this.url,callback:function(c){this.isLoading=false;this.events.triggerEvent("loadend");this.json=c.data},scope:this});a.read();this.request=a}else{this.request=OpenLayers.Request.GET({url:this.url,callback:function(c){this.isLoading=false;this.events.triggerEvent("loadend");if(c.status===200){this.parseData(c.responseText)}},scope:this})}}else{this.unload()}return b},abortLoading:function(){if(this.request){this.request.abort();delete this.request}this.isLoading=false},getFeatureInfo:function(b,a){var c=null;if(this.json){var d=this.getFeatureId(b,a);if(d!==null){c={id:d,data:this.json.data[d]}}}return c},getFeatureId:function(e,d){var a=null;if(this.json){var c=this.utfgridResolution;var k=Math.floor(d/c);var b=Math.floor(e/c);var g=this.json.grid[k].charCodeAt(b);var f=this.indexFromCharCode(g);var h=this.json.keys;if(!isNaN(f)&&(f in h)){a=h[f]}}return a},indexFromCharCode:function(a){if(a>=93){a--}if(a>=35){a--}return a-32},parseData:function(a){if(!this.format){this.format=new OpenLayers.Format.JSON()}this.json=this.format.read(a)},clear:function(){this.json=null},CLASS_NAME:"OpenLayers.Tile.UTFGrid"});