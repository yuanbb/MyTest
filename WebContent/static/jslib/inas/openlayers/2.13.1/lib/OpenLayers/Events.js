OpenLayers.Event={observers:false,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(a){return a.target||a.srcElement},isSingleTouch:function(a){return a.touches&&a.touches.length==1},isMultiTouch:function(a){return a.touches&&a.touches.length>1},isLeftClick:function(a){return(((a.which)&&(a.which==1))||((a.button)&&(a.button==1)))},isRightClick:function(a){return(((a.which)&&(a.which==3))||((a.button)&&(a.button==2)))},stop:function(b,a){if(!a){OpenLayers.Event.preventDefault(b)}if(b.stopPropagation){b.stopPropagation()}else{b.cancelBubble=true}},preventDefault:function(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}},findElement:function(c,b){var a=OpenLayers.Event.element(c);while(a.parentNode&&(!a.tagName||(a.tagName.toUpperCase()!=b.toUpperCase()))){a=a.parentNode}return a},observe:function(b,d,c,a){var e=OpenLayers.Util.getElement(b);a=a||false;if(d=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||e.attachEvent)){d="keydown"}if(!this.observers){this.observers={}}if(!e._eventCacheID){var f="eventCacheID_";if(e.id){f=e.id+"_"+f}e._eventCacheID=OpenLayers.Util.createUniqueID(f)}var g=e._eventCacheID;if(!this.observers[g]){this.observers[g]=[]}this.observers[g].push({element:e,name:d,observer:c,useCapture:a});if(e.addEventListener){e.addEventListener(d,c,a)}else{if(e.attachEvent){e.attachEvent("on"+d,c)}}},stopObservingElement:function(a){var b=OpenLayers.Util.getElement(a);var c=b._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[c])},_removeElementObservers:function(c){if(c){for(var a=c.length-1;a>=0;a--){var b=c[a];OpenLayers.Event.stopObserving.apply(this,[b.element,b.name,b.observer,b.useCapture])}}},stopObserving:function(h,a,g,b){b=b||false;var f=OpenLayers.Util.getElement(h);var d=f._eventCacheID;if(a=="keypress"){if(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||f.detachEvent){a="keydown"}}var k=false;var c=OpenLayers.Event.observers[d];if(c){var e=0;while(!k&&e<c.length){var j=c[e];if((j.name==a)&&(j.observer==g)&&(j.useCapture==b)){c.splice(e,1);if(c.length==0){delete OpenLayers.Event.observers[d]}k=true;break}e++}}if(k){if(f.removeEventListener){f.removeEventListener(a,g,b)}else{if(f&&f.detachEvent){f.detachEvent("on"+a,g)}}}return k},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var a in OpenLayers.Event.observers){var b=OpenLayers.Event.observers[a];OpenLayers.Event._removeElementObservers.apply(this,[b])}OpenLayers.Event.observers=false}},CLASS_NAME:"OpenLayers.Event"};OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,false);OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown"],listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:false,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(b,c,e,d,a){OpenLayers.Util.extend(this,a);this.object=b;this.fallThrough=d;this.listeners={};this.extensions={};this.extensionCount={};this._msTouches=[];if(c!=null){this.attachToElement(c)}},destroy:function(){for(var a in this.extensions){if(typeof this.extensions[a]!=="boolean"){this.extensions[a].destroy()}}this.extensions=null;if(this.element){OpenLayers.Event.stopObservingElement(this.element);if(this.element.hasScrollEvent){OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)}}this.element=null;this.listeners=null;this.object=null;this.fallThrough=null;this.eventHandler=null},addEventType:function(a){},attachToElement:function(d){if(this.element){OpenLayers.Event.stopObservingElement(this.element)}else{this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this);this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this)}this.element=d;var b=!!window.navigator.msMaxTouchPoints;var e;for(var c=0,a=this.BROWSER_EVENTS.length;c<a;c++){e=this.BROWSER_EVENTS[c];OpenLayers.Event.observe(d,e,this.eventHandler);if(b&&e.indexOf("touch")===0){this.addMsTouchListener(d,e,this.eventHandler)}}OpenLayers.Event.observe(d,"dragstart",OpenLayers.Event.stop)},on:function(a){for(var b in a){if(b!="scope"&&a.hasOwnProperty(b)){this.register(b,a.scope,a[b])}}},register:function(c,f,d,a){if(c in OpenLayers.Events&&!this.extensions[c]){this.extensions[c]=new OpenLayers.Events[c](this)}if(d!=null){if(f==null){f=this.object}var b=this.listeners[c];if(!b){b=[];this.listeners[c]=b;this.extensionCount[c]=0}var e={obj:f,func:d};if(a){b.splice(this.extensionCount[c],0,e);if(typeof a==="object"&&a.extension){this.extensionCount[c]++}}else{b.push(e)}}},registerPriority:function(a,c,b){this.register(a,c,b,true)},un:function(a){for(var b in a){if(b!="scope"&&a.hasOwnProperty(b)){this.unregister(b,a.scope,a[b])}}},unregister:function(d,f,e){if(f==null){f=this.object}var c=this.listeners[d];if(c!=null){for(var b=0,a=c.length;b<a;b++){if(c[b].obj==f&&c[b].func==e){c.splice(b,1);break}}}},remove:function(a){if(this.listeners[a]!=null){this.listeners[a]=[]}},triggerEvent:function(e,b){var d=this.listeners[e];if(!d||d.length==0){return undefined}if(b==null){b={}}b.object=this.object;b.element=this.element;if(!b.type){b.type=e}d=d.slice();var f;for(var c=0,a=d.length;c<a;c++){var g=d[c];f=g.func.apply(g.obj,[b]);if((f!=undefined)&&(f==false)){break}}if(!this.fallThrough){OpenLayers.Event.stop(b,true)}return f},handleBrowserEvent:function(j){var e=j.type,f=this.listeners[e];if(!f||f.length==0){return}var c=j.touches;if(c&&c[0]){var h=0;var g=0;var d=c.length;var b;for(var a=0;a<d;++a){b=this.getTouchClientXY(c[a]);h+=b.clientX;g+=b.clientY}j.clientX=h/d;j.clientY=g/d}if(this.includeXY){j.xy=this.getMousePosition(j)}this.triggerEvent(e,j)},getTouchClientXY:function(d){var e=window.olMockWin||window,c=e.pageXOffset,b=e.pageYOffset,a=d.clientX,f=d.clientY;if(d.pageY===0&&Math.floor(f)>Math.floor(d.pageY)||d.pageX===0&&Math.floor(a)>Math.floor(d.pageX)){a=a-c;f=f-b}else{if(f<(d.pageY-b)||a<(d.pageX-c)){a=d.pageX-c;f=d.pageY-b}}d.olClientX=a;d.olClientY=f;return{clientX:a,clientY:f}},clearMouseCache:function(){this.element.scrolls=null;this.element.lefttop=null;this.element.offsets=null},getMousePosition:function(a){if(!this.includeXY){this.clearMouseCache()}else{if(!this.element.hasScrollEvent){OpenLayers.Event.observe(window,"scroll",this.clearMouseListener);this.element.hasScrollEvent=true}}if(!this.element.scrolls){var b=OpenLayers.Util.getViewportElement();this.element.scrolls=[window.pageXOffset||b.scrollLeft,window.pageYOffset||b.scrollTop]}if(!this.element.lefttop){this.element.lefttop=[(document.documentElement.clientLeft||0),(document.documentElement.clientTop||0)]}if(!this.element.offsets){this.element.offsets=OpenLayers.Util.pagePosition(this.element)}return new OpenLayers.Pixel((a.clientX+this.element.scrolls[0])-this.element.offsets[0]-this.element.lefttop[0],(a.clientY+this.element.scrolls[1])-this.element.offsets[1]-this.element.lefttop[1])},addMsTouchListener:function(b,e,d){var a=this.eventHandler;var f=this._msTouches;function c(g){d(OpenLayers.Util.applyDefaults({stopPropagation:function(){for(var h=f.length-1;h>=0;--h){f[h].stopPropagation()}},preventDefault:function(){for(var h=f.length-1;h>=0;--h){f[h].preventDefault()}},type:e},g))}switch(e){case"touchstart":return this.addMsTouchListenerStart(b,e,c);case"touchend":return this.addMsTouchListenerEnd(b,e,c);case"touchmove":return this.addMsTouchListenerMove(b,e,c);default:throw"Unknown touch event type"}},addMsTouchListenerStart:function(c,e,d){var f=this._msTouches;var a=function(k){var h=false;for(var g=0,j=f.length;g<j;++g){if(f[g].pointerId==k.pointerId){h=true;break}}if(!h){f.push(k)}k.touches=f.slice();d(k)};OpenLayers.Event.observe(c,"MSPointerDown",a);var b=function(j){for(var g=0,h=f.length;g<h;++g){if(f[g].pointerId==j.pointerId){f.splice(g,1);break}}};OpenLayers.Event.observe(c,"MSPointerUp",b)},addMsTouchListenerMove:function(b,d,c){var e=this._msTouches;var a=function(h){if(h.pointerType==h.MSPOINTER_TYPE_MOUSE&&h.buttons==0){return}if(e.length==1&&e[0].pageX==h.pageX&&e[0].pageY==h.pageY){return}for(var f=0,g=e.length;f<g;++f){if(e[f].pointerId==h.pointerId){e[f]=h;break}}h.touches=e.slice();c(h)};OpenLayers.Event.observe(b,"MSPointerMove",a)},addMsTouchListenerEnd:function(b,d,c){var e=this._msTouches;var a=function(h){for(var f=0,g=e.length;f<g;++f){if(e[f].pointerId==h.pointerId){e.splice(f,1);break}}h.touches=e.slice();c(h)};OpenLayers.Event.observe(b,"MSPointerUp",a)},CLASS_NAME:"OpenLayers.Events"});