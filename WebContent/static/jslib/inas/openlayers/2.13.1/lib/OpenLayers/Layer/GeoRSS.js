OpenLayers.Layer.GeoRSS=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:true,initialize:function(c,a,b){OpenLayers.Layer.Markers.prototype.initialize.apply(this,[c,b]);this.location=a;this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadRSS:function(){if(!this.loaded){this.events.triggerEvent("loadstart");OpenLayers.Request.GET({url:this.location,success:this.parseData,scope:this});this.loaded=true}},moveTo:function(c,a,b){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);if(this.visibility&&!this.loaded){this.loadRSS()}},parseData:function(k){var o=k.responseXML;if(!o||!o.documentElement){o=OpenLayers.Format.XML.prototype.read(k.responseText)}if(this.useFeedTitle){var a=null;try{a=o.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue}catch(j){a=o.getElementsByTagName("title")[0].firstChild.nodeValue}if(a){this.setName(a)}}var s={};OpenLayers.Util.extend(s,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){s.externalProjection=this.projection;s.internalProjection=this.map.getProjectionObject()}var p=new OpenLayers.Format.GeoRSS(s);var b=p.read(o);for(var g=0,h=b.length;g<h;g++){var f={};var r=b[g];if(!r.geometry){continue}var m=r.attributes.title?r.attributes.title:"Untitled";var q=r.attributes.description?r.attributes.description:"No description.";var l=r.attributes.link?r.attributes.link:"";var n=r.geometry.getBounds().getCenterLonLat();f.icon=this.icon==null?OpenLayers.Marker.defaultIcon():this.icon.clone();f.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120);if(m||q){f.title=m;f.description=q;var c='<div class="olLayerGeoRSSClose">[x]</div>';c+='<div class="olLayerGeoRSSTitle">';if(l){c+='<a class="link" href="'+l+'" target="_blank">'}c+=m;if(l){c+="</a>"}c+="</div>";c+='<div style="" class="olLayerGeoRSSDescription">';c+=q;c+="</div>";f.popupContentHTML=c}var r=new OpenLayers.Feature(this,n,f);this.features.push(r);var d=r.createMarker();d.events.register("click",r,this.markerClick);this.addMarker(d)}this.events.triggerEvent("loadend")},markerClick:function(c){var e=(this==this.layer.selectedFeature);this.layer.selectedFeature=(!e)?this:null;for(var d=0,a=this.layer.map.popups.length;d<a;d++){this.layer.map.removePopup(this.layer.map.popups[d])}if(!e){var b=this.createPopup();OpenLayers.Event.observe(b.div,"click",OpenLayers.Function.bind(function(){for(var g=0,f=this.layer.map.popups.length;g<f;g++){this.layer.map.removePopup(this.layer.map.popups[g])}},this));this.layer.map.addPopup(b)}OpenLayers.Event.stop(c)},clearFeatures:function(){if(this.features!=null){while(this.features.length>0){var a=this.features[0];OpenLayers.Util.removeItem(this.features,a);a.destroy()}}},CLASS_NAME:"OpenLayers.Layer.GeoRSS"});